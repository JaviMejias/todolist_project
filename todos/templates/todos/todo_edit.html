<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Editar Tarea</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col items-center justify-center p-6 font-sans">

    <main class="w-full max-w-lg bg-white rounded-2xl shadow-xl p-8 space-y-6">
      <header class="text-center">
        <h1 class="text-3xl font-bold text-blue-600 mb-2">
            {% if is_completed %}Tarea Completada (Solo Lectura) üîí{% else %}Editar Tarea{% endif %}
        </h1>
        <p class="text-sm text-gray-500">
          {% if is_completed %}Esta tarea ya fue completada y no se permite la edici√≥n. ‚úÖ{% else %}Modifica los campos para actualizar la tarea. üìù{% endif %}
        </p>
      </header>
      
      <form method="post" class="space-y-4">
        {% csrf_token %}

        {% for field in form %}
          <div class="flex flex-col">
            <label for="{{ field.id_for_label }}" class="mb-1 text-sm font-semibold text-gray-700">
              {{ field.label }}
            </label>
            
            {% if is_completed %}
              {% with disabled_classes="w-full border border-gray-300 rounded-lg px-4 py-2 mt-1 bg-gray-100 text-gray-700 cursor-not-allowed" %}

                {% if field.name == 'description' %}
                  <textarea disabled rows="4" class="{{ disabled_classes }}">{{ field.value|default_if_none:'' }}</textarea>
                
                {% else %}
                  <input type="text" 
                         value="{{ field.value|default_if_none:'' }}" 
                         disabled
                         class="{{ disabled_classes }}">
                {% endif %}
                
              {% endwith %}

            {% else %}
              {{ field }}
            {% endif %}
          </div>
        {% endfor %}

        {% if is_completed %}
            <button type="button" disabled 
                    class="w-full bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg shadow-md cursor-not-allowed">
              Tarea Completada (No se puede editar)
            </button>
        {% else %}
            <button type="submit" 
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
              Guardar cambios
            </button>
        {% endif %}
      </form>

      <p class="text-center">
        <a href="{% url 'todo_list' %}" class="text-sm text-gray-500 hover:text-blue-500 hover:underline">
          &larr; Volver a la lista de tareas
        </a>
      </p>
    </main>

    <script>
      const isCompleted = JSON.parse("{{ is_completed|yesno:'true,false' }}".toLowerCase())
      
      if (isCompleted) {
        const showToast = (icon, title) => {
          const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 4000,
            timerProgressBar: true,
          })

          Toast.fire({
            icon: icon,
            title: title
          })
        }

        showToast('info', 'Edici√≥n Bloqueada: Tarea Completada.')
      }
    </script>
  </body>
</html>